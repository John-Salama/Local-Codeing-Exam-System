{% extends "base.html" %} {% block title %}Grade Submission - Exam System{%
endblock %} {% block head %}
<!-- CodeMirror - for syntax highlighting in view mode -->
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/codemirror.min.css"
/>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/theme/monokai.min.css"
/>
{% endblock %} {% block content %}
<div class="grade-container">
  <h2>Grade Submission</h2>

  <div class="student-info">
    <div class="info-row">
      <div class="info-label">Student:</div>
      <div class="info-value">{{ submission.student_name }}</div>
    </div>
    <div class="info-row">
      <div class="info-label">Student Number:</div>
      <div class="info-value">{{ submission.student_number }}</div>
    </div>
    <div class="info-row">
      <div class="info-label">Submission Time:</div>
      <div class="info-value">{{ submission.submission_time }}</div>
    </div>
    <div class="info-row">
      <div class="info-label">IP Address:</div>
      <div class="info-value">{{ submission.ip_address }}</div>
    </div>
    {% if model %}
    <div class="info-row">
      <div class="info-label">Exam Model:</div>
      <div class="info-value model-badge">{{ model.model_name }}</div>
    </div>
    {% endif %}
    <div class="info-row version-info">
      <div class="info-label">Version:</div>
      <div class="info-value">{{ submission.version }}</div>
      {% if not is_latest %}
      <div class="not-latest-warning">
        This is not the latest submission. Only the latest submission can be
        graded.
      </div>
      {% endif %}
    </div>
  </div>

  {% if error_message %}
  <div class="alert alert-danger">{{ error_message }}</div>
  {% endif %}

  <div class="question-answers">
    <h3>Answers</h3>
    {% for question in questions %}
    <div class="question-answer-panel">
      <div class="question-text">
        <strong>Question {{ loop.index }}:</strong> {{ question.question_text }}
      </div>
      <div class="answer-content">
        <pre class="code-block">
{{ question_answers.get(question.id, 'No answer provided') }}</pre
        >
      </div>
    </div>
    {% endfor %}
  </div>

  {% if can_grade %}
  <div class="grading-section">
    <h3>Grading</h3>

    <form method="POST">
      <div class="form-group">
        <label for="mark">Mark:</label>
        <input
          type="number"
          id="mark"
          name="mark"
          step="0.5"
          min="0"
          max="100"
          value="{{ grade.mark if grade else '' }}"
          required
        />
      </div>

      <div class="form-group">
        <label for="comment">Comment:</label>
        <textarea id="comment" name="comment" rows="4">
{{ grade.comment if grade else '' }}</textarea
        >
      </div>

      <div class="form-actions">
        <button type="submit" class="button primary">Submit Grade</button>
        <a
          href="{{ url_for('view_submissions', exam_id=submission.exam_id) }}"
          class="button"
          >Back</a
        >
      </div>
    </form>
  </div>
  {% else %}
  <div class="form-actions">
    <a
      href="{{ url_for('view_submissions', exam_id=submission.exam_id) }}"
      class="button"
      >Back</a
    >
  </div>
  {% endif %}
</div>
{% endblock %} {% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/mode/sql/sql.min.js"></script>
<script>
  // Initialize CodeMirror for read-only displays
  document.querySelectorAll(".code-display").forEach(function (textarea) {
    CodeMirror.fromTextArea(textarea, {
      lineNumbers: true,
      mode: "text/x-sql",
      theme: "monokai",
      readOnly: true,
    });
  });
</script>
{% endblock %}
